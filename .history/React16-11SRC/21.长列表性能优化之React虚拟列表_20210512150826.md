## 背景
在开发过程中，总是遇到很多列表的显示。当上数量级别的列表渲染于浏览器，终会导致浏览器的性能下降。如果数据量过大，首先渲染极慢，其次页面直接卡死。当然，你可以选择其他方式避免。例如分页，或者下载文件等等。我们这里讨论如果使用虚拟列表来解决这个问题。

## 什么是虚拟列表
最简单的描述：列表滚动时，变更`可视区域`内的渲染元素。<br>
![](./image/28.png)<br>

通过 `[单条数据预估高度]` 计算出 `[列表总高度]`和`[可视化区域高度 ]`。并在`[可视化区域高度]`内按需渲染列表。


## 相关概念简介
下面介绍在组件中，很重要的一些参数信息，这里先进行了解，有个印象，后续在使用的时候才比较明朗。

- `[单条数据预估高度]`： 列表中具体某一条列表的具体高度，它可以是 `[固定高度]`，也可以是`[动态高度]`
- `[列表总高度]`： 当所有数据渲染时，列表的`[总高度]`
- `[可视化区域高度]`: 挂在虚拟列表的容器。即列表可见的区域
- `[预估显示条数]`： 在 `[可视化区域高度]` 按照 `[单条数据预估高度]`，可见的数据条数
- `[开始索引]`: `[可视化区域高度]` 显示的数据的第一条数据的索引
- `[结束索引]`: `[可视化区域高度]` 显示的数据的最后一条数据的索引
- `[每条Item 位置缓存]`: 因为列表的高度不一定，因此会对每条数据的高度位置进行记录，包括 index索引，top, bottom, lineHeight属性

## 虚拟列表实现
虚拟列表可以简单理解为：当列表发生滚动时，变更`[可视化区域高度 ]`内的渲染元素，根据上面介绍的`相关概念`，我们依据这些属性，按照以下步骤进行：

- 传入组件数据 `[数据列表(resources)]` 和 `[预估高度（estimatedItemSize]`
- 根据 `[数据列表(resources)]`和 `[预估高度（estimatedItemSize]` 计算出每条数据的初始位置（当全部渲染时每条数据的占位）
- 计算出 `[列表总高度]`
- `[可视化区域高度]` 通过css控制
- 根据 `[可视化区域高度]`，计算出可视化区域预估显示条数
- 初始化可视窗口的 `[头挂载元素]`和`[尾挂载元素]`，当发生滚动时，根据滚动差值和滚动方向，重新计算`[头挂载元素]`和`[尾挂载元素]`。